{"ast":null,"code":"// fetchClientRate ফাংশনে নতুন ফিল্ড যোগ করুন\nconst fetchClientRate = async (name, address) => {\n  try {\n    const token = localStorage.getItem(\"token\");\n    const res = await fetch(\"http://localhost:5000/api/clients/check\", {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json\",\n        Authorization: token ? `Bearer ${token}` : \"\"\n      },\n      body: JSON.stringify({\n        name,\n        address\n      })\n    });\n    const data = await res.json();\n    if (data.success && data.client) {\n      var _data$client$ratePerK, _data$client$usdSurch, _data$client$baseRate, _data$client$extraRat;\n      return {\n        ratePerKg: (_data$client$ratePerK = data.client.ratePerKg) !== null && _data$client$ratePerK !== void 0 ? _data$client$ratePerK : 0,\n        usdSurcharge: (_data$client$usdSurch = data.client.usdSurcharge) !== null && _data$client$usdSurch !== void 0 ? _data$client$usdSurch : 0,\n        baseRate: (_data$client$baseRate = data.client.baseRate) !== null && _data$client$baseRate !== void 0 ? _data$client$baseRate : 0,\n        // নতুন ফিল্ড\n        extraRatePerKg: (_data$client$extraRat = data.client.extraRatePerKg) !== null && _data$client$extraRat !== void 0 ? _data$client$extraRat : 0 // নতুন ফিল্ড\n      };\n    }\n  } catch (err) {\n    console.error(\"Rate fetch error:\", err);\n  }\n  return null;\n};\n\n// প্রাইসিং লজিক আপডেট করুন\nlet finalPrice = 0;\nif (consignee && wt > 0) {\n  var _cneeAddress;\n  const rateConfig = await fetchClientRate(consignee.toString().trim(), (_cneeAddress = cneeAddress) === null || _cneeAddress === void 0 ? void 0 : _cneeAddress.toString().trim());\n  if (rateConfig) {\n    console.log(`Client: ${consignee}, WT: ${wt}, Base Rate: ${rateConfig.baseRate}, Extra Rate: ${rateConfig.extraRatePerKg}`);\n\n    // নতুন টায়ার্ড প্রাইসিং মডেল\n    if (rateConfig.baseRate > 0 && rateConfig.extraRatePerKg > 0) {\n      if (wt <= 1) {\n        finalPrice = rateConfig.baseRate;\n      } else {\n        finalPrice = rateConfig.baseRate + (wt - 1) * rateConfig.extraRatePerKg;\n      }\n      console.log(`Using tiered pricing: ${finalPrice} = ${rateConfig.baseRate} + (${wt} - 1) * ${rateConfig.extraRatePerKg}`);\n    }\n    // পুরানো লজিক (ব্যাকওয়ার্ড কম্প্যাটিবিলিটির জন্য)\n    else if (rateConfig.ratePerKg > 0 && wt === rateConfig.ratePerKg) {\n      finalPrice = rateConfig.usdSurcharge;\n      console.log(`Using USD Surcharge: ${finalPrice} (WT matches RatePerKG)`);\n    } else if (rateConfig.ratePerKg > 0) {\n      finalPrice = wt * rateConfig.ratePerKg;\n      console.log(`Using normal calculation: ${finalPrice} = ${wt} × ${rateConfig.ratePerKg}`);\n    } else if (rateConfig.usdSurcharge > 0) {\n      finalPrice = rateConfig.usdSurcharge;\n      console.log(`Using USD Surcharge: ${finalPrice} (No RatePerKG configured)`);\n    }\n  } else {\n    console.warn(`কোনো ক্লাইন্ট পাওয়া যায়নি: ${consignee}`);\n  }\n}","map":{"version":3,"names":["fetchClientRate","name","address","token","localStorage","getItem","res","fetch","method","headers","Authorization","body","JSON","stringify","data","json","success","client","_data$client$ratePerK","_data$client$usdSurch","_data$client$baseRate","_data$client$extraRat","ratePerKg","usdSurcharge","baseRate","extraRatePerKg","err","console","error","finalPrice","consignee","wt","_cneeAddress","rateConfig","toString","trim","cneeAddress","log","warn"],"sources":["D:/PG/git bill import/excel-bill-home-main/excel-bill-home-main/client/src/components/FileUpload.js"],"sourcesContent":["// fetchClientRate ফাংশনে নতুন ফিল্ড যোগ করুন\nconst fetchClientRate = async (name, address) => {\n  try {\n    const token = localStorage.getItem(\"token\");\n    const res = await fetch(\"http://localhost:5000/api/clients/check\", {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json\",\n        Authorization: token ? `Bearer ${token}` : \"\",\n      },\n      body: JSON.stringify({ name, address }),\n    });\n    const data = await res.json();\n    if (data.success && data.client) {\n      return {\n        ratePerKg: data.client.ratePerKg ?? 0,\n        usdSurcharge: data.client.usdSurcharge ?? 0,\n        baseRate: data.client.baseRate ?? 0, // নতুন ফিল্ড\n        extraRatePerKg: data.client.extraRatePerKg ?? 0, // নতুন ফিল্ড\n      };\n    }\n  } catch (err) {\n    console.error(\"Rate fetch error:\", err);\n  }\n  return null;\n};\n\n// প্রাইসিং লজিক আপডেট করুন\nlet finalPrice = 0;\nif (consignee && wt > 0) {\n  const rateConfig = await fetchClientRate(\n    consignee.toString().trim(),\n    cneeAddress?.toString().trim()\n  );\n\n  if (rateConfig) {\n    console.log(`Client: ${consignee}, WT: ${wt}, Base Rate: ${rateConfig.baseRate}, Extra Rate: ${rateConfig.extraRatePerKg}`);\n    \n    // নতুন টায়ার্ড প্রাইসিং মডেল\n    if (rateConfig.baseRate > 0 && rateConfig.extraRatePerKg > 0) {\n      if (wt <= 1) {\n        finalPrice = rateConfig.baseRate;\n      } else {\n        finalPrice = rateConfig.baseRate + (wt - 1) * rateConfig.extraRatePerKg;\n      }\n      console.log(`Using tiered pricing: ${finalPrice} = ${rateConfig.baseRate} + (${wt} - 1) * ${rateConfig.extraRatePerKg}`);\n    }\n    // পুরানো লজিক (ব্যাকওয়ার্ড কম্প্যাটিবিলিটির জন্য)\n    else if (rateConfig.ratePerKg > 0 && wt === rateConfig.ratePerKg) {\n      finalPrice = rateConfig.usdSurcharge;\n      console.log(`Using USD Surcharge: ${finalPrice} (WT matches RatePerKG)`);\n    } \n    else if (rateConfig.ratePerKg > 0) {\n      finalPrice = wt * rateConfig.ratePerKg;\n      console.log(`Using normal calculation: ${finalPrice} = ${wt} × ${rateConfig.ratePerKg}`);\n    }\n    else if (rateConfig.usdSurcharge > 0) {\n      finalPrice = rateConfig.usdSurcharge;\n      console.log(`Using USD Surcharge: ${finalPrice} (No RatePerKG configured)`);\n    }\n  } else {\n    console.warn(`কোনো ক্লাইন্ট পাওয়া যায়নি: ${consignee}`);\n  }\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}